# S007 - Orchestration ultra-quality-check depuis le cockpit

canonical_story_id: E01-S07
epic: E01
source_of_truth: _bmad-output/planning-artifacts/epics.md

## Scope canonique
- Story ID canonique: `E01-S07`
- FR clés: FR-007, FR-008
- NFR clés: NFR-013, NFR-017
- Risques: P02, P03
- Dépendance story: E01-S06

## Pourquoi réouverture
- Story réouverte pour réalignement canonique: fr_missing:FR-007,FR-008
- Ancienne version archivée sous `_bmad-output/implementation-artifacts/archive/`.

## Checklist Delivery
- [x] Implémentation conforme au scope canonique
- [x] Tests unit/intégration
- [x] Tests edge
- [x] Tests e2e
- [x] Coverage >= seuil
- [x] Security scan dépendances
- [x] Build
- [ ] Audit UX PASS

## Exécution DEV (H13/H16)
- Date exécution gates (UTC): 2026-02-22T13:53:56Z → 2026-02-22T13:54:42Z
- Preuve logs: `_bmad-output/implementation-artifacts/handoffs/S007-tech-gates.log`
- Fichiers scope validés:
  - `app/src/phase-guards-orchestrator.js`
  - `app/src/phase-transition-history.js`
  - `app/src/phase-sla-alert.js`
  - `app/tests/unit/phase-guards-orchestrator.test.js`
  - `app/tests/edge/phase-guards-orchestrator.edge.test.js`
  - `app/tests/e2e/phase-guards-orchestrator.spec.js`
  - `app/tests/unit/phase-transition-history.test.js`
  - `app/tests/edge/phase-transition-history.edge.test.js`
  - `app/tests/e2e/phase-transition-history.spec.js`
  - `app/tests/unit/phase-sla-alert.test.js`
  - `app/tests/edge/phase-sla-alert.edge.test.js`
  - `app/tests/e2e/phase-sla-alert.spec.js`
- Résultats:
  - lint/typecheck/build/security: PASS
  - tests unit+edge: 32 fichiers / 421 tests PASS
  - tests e2e: 31/31 PASS
  - coverage modules S007:
    - `phase-guards-orchestrator.js`: 100% lines / 100% branches
    - `phase-transition-history.js`: 100% lines / 98.52% branches
    - `phase-sla-alert.js`: 100% lines / 97.05% branches

## Mapping AC → tests
- **AC-01 (FR-007 historique consultable transitions + verdicts)**
  - unit (`phase-transition-history.test.js`):
    - `records a nominal transition and appends an entry immutably`
    - `propagates blocking guard verdict while still recording the event`
    - `filters consulted history by query fields and returns newest entries first`
    - `applies retention policy and reports droppedCount accurately`
  - edge (`phase-transition-history.edge.test.js`):
    - validation stricte payload/history/guardResult + robustesse tri/query/retention
  - e2e (`phase-transition-history.spec.js`):
    - états UI `empty/loading/error/success` + rendu listes historiques/raison

- **AC-02 (FR-008 alerte dépassement SLA + action corrective)**
  - unit (`phase-sla-alert.test.js`):
    - `propagates current SLA breach with ordered warning corrective actions`
    - `escalates to critical when recurrence threshold is reached in lookback window`
    - `delegates to validatePhaseTransition when transitionInput is provided`
  - edge (`phase-sla-alert.edge.test.js`):
    - validation stricte de payloads invalides, lookback/escalation, fenêtres temporelles
  - e2e (`phase-sla-alert.spec.js`):
    - états UI `empty/loading/error/success` + severity + correctiveActions visibles

- **AC-03 (NFR-013 fiabilité commandes autorisées >=95%)**
  - unit/edge (`phase-guards-orchestrator.*`):
    - plan de commandes strict `CMD-008` / `CMD-009`
    - modes `simulate`/`apply`, arrêt au premier échec, preuve `failedCommand`
    - robustesse sur exécutions mockées (bool/object/error)
  - couverture module: `phase-guards-orchestrator.js` 100% lines / 100% branches

- **AC-04 (NFR-017 MTTA alerte critique <10 min)**
  - unit (`phase-sla-alert.test.js`):
    - escalade critique conditionnelle via `lookbackMinutes` + `escalationThreshold`
  - edge (`phase-sla-alert.edge.test.js`):
    - comptage incidents récents uniquement dans la fenêtre temporelle
  - e2e (`phase-sla-alert.spec.js`):
    - visibilité immédiate de severity + correctiveActions en UI

## Comment tester (simple)
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-story-gates.sh S007`
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-ux-gates.sh S007`

## Status
READY_FOR_UXQA_TEA
