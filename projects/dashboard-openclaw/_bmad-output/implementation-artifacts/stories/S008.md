# S008 - Historique consultable des transitions

canonical_story_id: E01-S08
epic: E01
source_of_truth: _bmad-output/planning-artifacts/epics.md

## Scope canonique
- Story ID canonique: `E01-S08`
- FR clés: FR-008, FR-009
- NFR clés: NFR-017, NFR-034
- Risques: P03, P06
- Dépendance story: E01-S07

## Pourquoi réouverture
- Story réouverte pour réalignement canonique: fr_missing:FR-008,FR-009
- Ancienne version archivée sous `_bmad-output/implementation-artifacts/archive/`.

## Checklist Delivery
- [x] Implémentation conforme au scope canonique
- [x] Tests unit/intégration
- [x] Tests edge
- [x] Tests e2e
- [x] Coverage >= seuil
- [x] Security scan dépendances
- [x] Build
- [ ] Audit UX PASS

## Exécution DEV (H13/H16)
- Date exécution gates (UTC): 2026-02-22T14:43:54Z → 2026-02-22T14:44:40Z
- Preuve logs: `_bmad-output/implementation-artifacts/handoffs/S008-tech-gates.log`
- Fichiers scope validés:
  - `app/src/phase-transition-history.js`
  - `app/src/phase-sla-alert.js`
  - `app/tests/unit/phase-transition-history.test.js`
  - `app/tests/edge/phase-transition-history.edge.test.js`
  - `app/tests/e2e/phase-transition-history.spec.js`
  - `app/tests/unit/phase-sla-alert.test.js`
  - `app/tests/edge/phase-sla-alert.edge.test.js`
  - `app/tests/e2e/phase-sla-alert.spec.js`
- Résultats:
  - lint/typecheck/build/security: PASS
  - tests unit+edge: 32 fichiers / 425 tests PASS
  - tests e2e: 31/31 PASS
  - couverture modules S008:
    - `phase-transition-history.js`: 100% lines / 97.53% branches / 100% functions
    - `phase-sla-alert.js`: 100% lines / 97.05% branches / 100% functions

## Mapping AC -> preuves/tests
- **AC-01 / FR-008** — signaler dépassements SLA + action corrective
  - unit (`phase-sla-alert.test.js`):
    - `propagates current SLA breach with ordered warning corrective actions`
    - `escalates to critical when recurrence threshold is reached in lookback window`
    - `delegates to validatePhaseTransition when transitionInput is provided`
  - edge (`phase-sla-alert.edge.test.js`):
    - validation stricte payload/lookback/escalation/history
    - comptage temporel incidents SLA + escalade
  - e2e (`phase-sla-alert.spec.js`):
    - états `empty/loading/error/success`
    - severity + correctiveActions visibles en UI

- **AC-02 / FR-009 (abuse case sans contournement)** — aucune tentative override exceptionnelle sans justification/approbateur traçables
  - implémentation (`phase-transition-history.js`):
    - politique fail-closed sur `overrideAttempt` non traçable
    - rejet explicite via `TRANSITION_NOT_ALLOWED`
    - traçabilité conservée dans `entry.guardDiagnostics.overrideAttempt`
  - unit (`phase-transition-history.test.js`):
    - `blocks override abuse without justification/approver and keeps trace in history`
    - `allows traceable override attempt when justification and approver are provided`
  - edge (`phase-transition-history.edge.test.js`):
    - `fails closed and records blocked trace when overrideAttempt payload is non-object`
    - `reuses guard diagnostics overrideAttempt when payload overrideAttempt is absent`
  - e2e (`phase-transition-history.spec.js`):
    - scénario `override-abuse` avec preuve UI reasonCode + raison + entrée historisée

- **AC-03 / NFR-017** — MTTA alerte critique < 10 min
  - unit+edge (`phase-sla-alert.*`):
    - escalade critique déclenchée immédiatement selon fenêtre/lookback/threshold
    - action corrective `ESCALATE_TO_PM` incluse dès seuil atteint

- **AC-04 / NFR-034** — métriques clés disponibles en continu
  - `phase-transition-history.js`: diagnostics continus (`totalCount`, `returnedCount`, `droppedCount`, `blockedByGuard`)
  - `phase-sla-alert.js`: diagnostics continus (`recentSlaBreachCount`, `escalationRequired`, `lookbackMinutes`, `sourceReasonCode`)
  - e2e history + sla: exposition visible des reason codes/états/détails d’alerte

## Comment tester (simple)
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-story-gates.sh S008`
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-ux-gates.sh S008`

## Status
READY_FOR_UXQA_TEA
