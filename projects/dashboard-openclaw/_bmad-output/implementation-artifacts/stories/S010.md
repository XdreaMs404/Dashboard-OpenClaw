# S010 - Carte dépendances inter-phases en temps réel

canonical_story_id: E01-S10
epic: E01
source_of_truth: _bmad-output/planning-artifacts/epics.md

## Scope canonique
- Story ID canonique: `E01-S10`
- FR clés: FR-010, FR-001
- NFR clés: NFR-040, NFR-011
- Risques: P07, P01
- Dépendance story: E01-S09

## Pourquoi réouverture
- Story réouverte pour réalignement canonique: fr_missing:FR-001
- Ancienne version archivée sous `_bmad-output/implementation-artifacts/archive/`.

## Checklist Delivery
- [x] Implémentation conforme au scope canonique
- [x] Tests unit/intégration
- [x] Tests edge
- [x] Tests e2e
- [x] Coverage >= seuil
- [x] Security scan dépendances
- [x] Build
- [ ] Audit UX PASS

## Exécution DEV (H13/H16)
- Date exécution gates (UTC): 2026-02-22T16:26:56Z → 2026-02-22T16:27:43Z
- Preuve logs: `_bmad-output/implementation-artifacts/handoffs/S010-tech-gates.log`
- Portée stricte S010 appliquée.

### Changements fichiers (S010 uniquement)
- Modifié:
  - `app/tests/unit/phase-dependency-matrix.test.js`
    - ajout test FR-001: blocage d’une transition non canonique via `transitionInput` (`H05 -> H04`) avec action corrective `ALIGN_PHASE_SEQUENCE`.
- Vérifiés sans changement fonctionnel:
  - `app/src/phase-dependency-matrix.js`
  - `app/tests/edge/phase-dependency-matrix.edge.test.js`
  - `app/tests/e2e/phase-dependency-matrix.spec.js`

## Mapping AC -> preuves/tests
- **AC-01 / FR-010** — dépendances bloquantes inter-phases + état temps réel
  - unit `phase-dependency-matrix.test.js`: dépendances `TRANSITION/PREREQUISITES/OVERRIDE/FRESHNESS`, `blockingDependencies`, stale state `DEPENDENCY_STATE_STALE`.
  - edge `phase-dependency-matrix.edge.test.js`: validation stricte entrées/contrats + agrégation robuste blocages.
  - e2e `phase-dependency-matrix.spec.js`: états `empty/loading/error/success`, owner, blocages et corrective actions visibles.

- **AC-02 / FR-001** — progression canonique BMAD H01→H23 sans dérive
  - unit `phase-dependency-matrix.test.js`:
    - `blocks non-canonical transition order from transitionInput and recommends ALIGN_PHASE_SEQUENCE`.
  - preuve de propagation stricte: `allowed=false` tant qu’une dépendance bloquante active.

- **AC-03 / NFR-040** — sortie actionnable immédiatement
  - messages reasonCode + `correctiveActions` explicites (`ALIGN_PHASE_SEQUENCE`, `COMPLETE_PREREQUISITES`, `REQUEST_OVERRIDE_APPROVAL`, `REFRESH_DEPENDENCY_MATRIX`).

- **AC-04 / NFR-011** — fiabilité opérationnelle >= 99.5%
  - exécution complète gates sans échec (lint/typecheck/tests/e2e/build/security).

## Mapping DoD -> preuves
- **DoD-01** tests unit/intégration/e2e: ✅
- **DoD-02** sécurité: ✅ (`npm audit --audit-level=high` => 0 vulnérabilité)
- **DoD-03** preuve UX states/a11y/responsive: ✅ (e2e matrix)
- **DoD-04** instrumentation diagnostics/alertes: ✅ diagnostics `owner/snapshotAgeMs/isStale/blockedDependenciesCount/sourceReasonCode`
- **DoD-05** mapping FR/NFR/Risque + owner + échéance: ✅ documenté ici
- **DoD-06** handoff clair: ✅ `_bmad-output/implementation-artifacts/handoffs/S010-dev-to-uxqa-tea.md`

## Commandes exécutées (DEV gates)
- `cd /root/.openclaw/workspace/projects/dashboard-openclaw/app`
- `npm run lint`
- `npm run typecheck`
- `npx vitest run tests/unit tests/edge`
- `npx playwright test tests/e2e`
- `npm run test:coverage`
- `npm run build`
- `npm run security:deps`

## Résultats gates
- lint/typecheck/build/security: PASS
- tests unit+edge: 32 fichiers / 426 tests PASS
- tests e2e: 31/31 PASS
- couverture globale: 99.34% lines / 97.85% branches
- couverture module S010 `phase-dependency-matrix.js`: 99.63% lines / 99.23% branches / 100% functions

## Comment tester (simple)
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-story-gates.sh S010`
- `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-ux-gates.sh S010`

## Status
READY_FOR_UXQA_TEA