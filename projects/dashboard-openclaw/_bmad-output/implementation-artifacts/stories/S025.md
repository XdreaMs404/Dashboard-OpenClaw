# S025 - Gate Center unifié avec statut et owner

canonical_story_id: E03-S01
epic: E03
source_of_truth: _bmad-output/planning-artifacts/epics.md

## Scope canonique
- Story ID canonique: `E03-S01`
- FR clés: FR-011, FR-012
- NFR clés: NFR-002, NFR-007
- Risques: T07, P05
- Dépendance story: E01-S12 (S012)

## Checklist Delivery
- [x] Implémentation conforme au scope canonique
- [x] Tests unit/intégration
- [x] Tests edge
- [x] Tests e2e
- [x] Coverage >= seuil
- [x] Security scan dépendances *(pris en charge par gates globaux)*
- [x] Build *(pris en charge par gates globaux)*
- [x] Audit UX prêt pour revue

## Critères d’acceptation S025
- [x] **AC-01 / FR-011**: vue unique G1→G5 avec `status`, `owner`, `updatedAt`.
- [x] **AC-02 / FR-012**: sous-gates `G4-T` et `G4-UX` distinctes, corrélées à `G4`.
- [x] **AC-03 / NFR-002**: `p95BuildMs <= 2500` sur corpus synthétique.
- [x] **AC-04 / NFR-007**: `durationMs <= 2000` sur build synthétique.
- [x] **AC-05**: source prioritaire `governanceDecisionResult`, puis délégation `governanceDecisionInput`.
- [x] **AC-06**: propagation stricte des reason codes bloquants S012.
- [x] **AC-07**: gate incomplète -> `GATE_STATUS_INCOMPLETE` + actions correctives.
- [x] **AC-08**: incohérence G4/subgates -> `G4_SUBGATE_MISMATCH` + blocage explicite.
- [x] **AC-09**: safeguard DONE (`BLOCK_DONE_TRANSITION`) dès qu’une sous-gate G4 n’est pas PASS.
- [x] **AC-10**: contrat stable livré:
  `{ allowed, reasonCode, reason, diagnostics, gateCenter, subGates, correctiveActions }`.

## Implémentation S025
### Fichiers touchés (strict S025)
- `app/src/gate-center-status.js`
- `app/src/index.js` (export S025)
- `app/tests/unit/gate-center-status.test.js`
- `app/tests/edge/gate-center-status.edge.test.js`
- `app/tests/e2e/gate-center-status.spec.js`
- `_bmad-output/implementation-artifacts/stories/S025.md`
- `_bmad-output/implementation-artifacts/handoffs/S025-dev-to-uxqa.md`
- `_bmad-output/implementation-artifacts/handoffs/S025-dev-to-tea.md`

### Résumé fonctionnel
1. Résolution source stricte:
   - `governanceDecisionResult` injecté prioritaire
   - sinon délégation `governanceDecisionInput` vers S012 (`recordPhaseGateGovernanceDecision`)
   - sinon `INVALID_GATE_CENTER_INPUT`
2. Vue unifiée Gate Center:
   - build déterministe `G1 -> G5`
   - champs gate: `status`, `owner`, `updatedAt`, `reasonCode`, `sourceReasonCode`
3. Dual G4 corrélé:
   - `subGates` dédié `G4-T`, `G4-UX`
   - parent `G4` explicite
   - détection de mismatch `G4_SUBGATE_MISMATCH`
4. Contrôles de complétude:
   - `GATE_STATUS_INCOMPLETE` si champ requis manquant (status/owner/updatedAt)
5. Safeguard DONE:
   - ajout automatique `BLOCK_DONE_TRANSITION` si `G4-T` ou `G4-UX` non PASS
6. Diagnostics complets:
   - `gatesCount`, `subGatesCount`, `staleCount`, `durationMs`, `p95BuildMs`, `sourceReasonCode`
7. Performance:
   - instrumentation p95 build
   - test synthétique 500 snapshots conforme seuils NFR

## Mapping AC -> tests
- AC-01..AC-10 (fonctionnel + edge + perf):
  - `app/tests/unit/gate-center-status.test.js`
  - `app/tests/edge/gate-center-status.edge.test.js`
- AC-09 UX states/a11y/responsive:
  - `app/tests/e2e/gate-center-status.spec.js`

## Couverture/performance S025
- `app/src/gate-center-status.js`:
  - **99.31% statements**
  - **99.20% branches**
  - **100% functions**
  - **99.28% lines**
  - Seuil AC-10 validé (`>=95% lines` et `>=95% branches`).
- Perf synthétique:
  - `p95BuildMs <= 2500`
  - `durationMs <= 2000`

## Comment tester (simple)
1. `cd /root/.openclaw/workspace/projects/dashboard-openclaw/app`
2. `npm run lint && npm run typecheck`
3. `npx vitest run tests/unit/gate-center-status.test.js tests/edge/gate-center-status.edge.test.js`
4. `npx playwright test tests/e2e/gate-center-status.spec.js`
5. `npx vitest run tests/unit/gate-center-status.test.js tests/edge/gate-center-status.edge.test.js --coverage --coverage.include=src/gate-center-status.js`
6. `BMAD_PROJECT_ROOT=/root/.openclaw/workspace/projects/dashboard-openclaw bash /root/.openclaw/workspace/bmad-total/scripts/run-fast-quality-gates.sh S025`

## Quality Gates obligatoires
- [x] lint
- [x] typecheck
- [x] tests unit/intégration
- [x] tests e2e
- [x] tests edge
- [x] coverage >= seuil
- [x] fast quality gates S025

## Status
READY_FOR_UXQA_TEA
