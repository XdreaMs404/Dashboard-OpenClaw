# S001 - Normalisation de nom utilisateur

## Epic
E01

## User story
En tant qu’utilisateur qui saisit son nom dans un formulaire,
je veux que l’application normalise automatiquement ce nom,
afin d’obtenir un affichage propre, cohérent et exploitable sans perdre les accents ni la casse.

## Critères d'acceptation
- [x] La fonction `normalizeUserName(input)` est implémentée dans `app/src/core.js` et exportée via `app/src/index.js`.
- [x] `normalizeUserName("  Jean   Dupont  ")` retourne exactement `"Jean Dupont"`.
- [x] `normalizeUserName(" Élodie   Martin ")` retourne exactement `"Élodie Martin"` (accents et majuscules préservés).
- [x] Les séparateurs internes consécutifs (espaces, tabulations, retours ligne) sont réduits à un seul espace.
- [x] Si la valeur est vide après normalisation (`""`, `"   "`, `"\n\t"`), la fonction lève une `Error` avec le message exact `Le nom utilisateur est vide après normalisation`.
- [x] Si `input` n’est pas de type chaîne, la fonction lève une `Error` avec le message exact `Le nom utilisateur doit être une chaîne de caractères`.
- [x] Un flux UI minimal de démonstration est couvert en E2E avec les états `loading`, `empty`, `error`, `success`.
- [x] En état `success`, la valeur normalisée est affichée dans une zone annoncée (`aria-live="polite"`).
- [x] En état `error`, un message lisible est affiché sans bloquer une nouvelle saisie.

## Cas de test obligatoires
### Fonctionnels
- [x] Cas nominal: saisie `"  Jean   Dupont  "` → résultat `"Jean Dupont"`.
- [x] Cas accents/casse: saisie `"  ÉLODIE   Martin "` → résultat `"ÉLODIE Martin"`.
- [x] Cas séparateurs multiples: saisie avec espaces + tabulations + retours ligne → un seul espace entre mots.
- [x] Cas erreur vide: `""`, `"   "`, `"\n\t"` lèvent l’erreur attendue.
- [x] Cas UI succès: parcours `empty → loading → success` validé en E2E.
- [x] Cas UI erreur: parcours `empty → loading → error` validé en E2E.

### Non-régression
- [x] Les comportements existants de `safeDivide`, `normalizeEmail` et `clamp` restent inchangés.
- [x] Les tests unitaires et edge existants passent sans ajustement de leurs attentes.
- [x] Le smoke test E2E existant reste vert.

### Sécurité / robustesse
- [x] Validation stricte du type d’entrée (`string` uniquement).
- [x] Le traitement d’une chaîne longue (>= 10 000 caractères) reste stable et retourne une sortie correcte.
- [x] Aucun ajout de dépendance externe pour cette story.
- [x] Aucun usage de `eval`, `Function` dynamique ou logique risquée inutile.

## Implémentation
### Réalisé (DEV)
1. `normalizeUserName(input)` implémentée dans `app/src/core.js` (validation type + trim + normalisation `\s+` + erreur explicite si vide).
2. Export public vérifié via `app/src/index.js` (`normalizeUserName` toujours exposée).
3. Renforcement des tests unitaires `app/tests/unit/core.test.js`:
   - cas nominaux,
   - accents/casse,
   - séparateurs,
   - test explicite de l’export via `src/index.js`.
4. Renforcement des tests edge `app/tests/edge/core.edge.test.js`:
   - vérification **stricte** des messages d’erreur (`===`),
   - robustesse long input,
   - couverture non-régression `clamp` sur types invalides.
5. Renforcement e2e `app/tests/e2e/normalize-user-name.spec.js`:
   - validation des états `empty/loading/error/success`,
   - visibilité explicite du message d’erreur,
   - vérification de réactivation du bouton après traitement.

## Review
- Couverture fonctionnelle S001 validée par tests unit + edge + e2e.
- Non-régression vérifiée (core tests + smoke e2e).
- Gates techniques exécutés et passants (`lint`, `typecheck`, `tests`, `coverage`, `build`, `security:deps`).

## Comment tester (simple)
1. `cd /root/.openclaw/workspace/projects/dashboard-openclaw/app`
2. `npm run lint && npm run typecheck`
3. `npx vitest run tests/unit/core.test.js tests/edge/core.edge.test.js`
4. `npx playwright test tests/e2e/normalize-user-name.spec.js tests/e2e/smoke.spec.js`
5. `npm run test:coverage`
6. `npm run build && npm run security:deps`


## Quality Gates obligatoires
- [x] lint
- [x] typecheck
- [x] tests unit/intégration
- [x] tests e2e
- [x] tests cas limites (edge)
- [x] coverage >= seuil
- [x] security scan dépendances
- [x] build

## Règle Story DONE
- Interdit de passer DONE si un seul gate échoue (technique OU UX).
- Audit UX obligatoire: `_bmad-output/implementation-artifacts/ux-audits/<SID>-ux-audit.json` avec verdict PASS.
- Utiliser `bash scripts/story-done-guard.sh <SID>` pour valider la fin.

## UX Gates obligatoires
- [ ] conformité design-system (tokens, spacing, typo, composants)
- [ ] accessibilité WCAG 2.2 AA (minimum)
- [ ] responsive (mobile/tablet/desktop)
- [ ] états d'interface (loading/empty/error/success)
- [ ] hiérarchie visuelle et lisibilité
- [ ] evidence UX fournie (captures/rapports)

## Status
READY_FOR_REVIEW
