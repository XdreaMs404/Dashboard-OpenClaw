# Post-mortem incidents récents (UTC)
## Fenêtre: 2026-02-22 → 2026-02-23

## 1) Périmètre et sources
Ce dossier `logs/` est maintenant la base d’analyse des incidents récents du projet.

Sources utilisées:
- `logs/errors-2026-02-22_2026-02-23.csv` (table complète exploitable)
- `logs/errors-2026-02-22_2026-02-23.json` (même dataset en JSON)
- `logs/errors-2026-02-22_2026-02-23.summary.json` (agrégats)
- `runtime/story-checkpoints/S023.json` (état live de la story S023)
- `memory/2026-02-22.md`, `memory/2026-02-23.md` (RCA et correctifs durables)

---

## 2) Synthèse chiffrée (erreurs + blocages)
Total événements extraits sur la fenêtre: **321**

Répartition par type:
- `blocked`: **109**
- `reviewer_loop_exceeded`: **93**
- `job_timeout`: **29**
- `gateway_timeout`: **26**
- `session_lock`: **15**
- `provider_limit`: **13**
- `bootstrap_dev_impossible`: **12**
- `tool_not_found_rg`: **10**
- `slo_30`: **7**
- `slo_45`: **7**

Répartition par jour:
- **2026-02-22**: 52 événements
- **2026-02-23**: 269 événements

Stories les plus impactées:
- **S012**: 190 événements (pic majeur)
- **S019**: 14
- **S018 / S020 / S021 / S022 / S023**: 4 chacun

---

## 3) Focus demandé: story S023 (en cours)
État checkpoint actuel (`runtime/story-checkpoints/S023.json`):
- `STEP=dev`
- `ATTEMPT_DEV=9`
- `ELAPSED ≈ 112 min` (au moment de l’extraction)

Timeline S023 (preuves directes):
- `2026-02-23T17:18:48Z` → `⏱️ SLO S023 >30min`
- `2026-02-23T17:21:28Z` → `⏱️ SLO S023 >45min`
- `2026-02-23T17:34:29Z` → `⚠️ BLOCKED S023 bootstrap_dev_impossible`
- `2026-02-23T17:56:37Z` → `session file locked (timeout 10000ms)` sur session `bmad-dev`

### Cause racine détaillée S023
Cause dominante = **échec de bootstrap DEV sous contention de session**:
1. Le runtime tente de lancer le step DEV.
2. L’agent DEV rencontre un lock de fichier de session (`.jsonl.lock`) non libéré dans le délai attendu.
3. Le fallback embarqué démarre mais ne résout pas toujours le lock source.
4. Les retries incrémentent `ATTEMPT_DEV` puis aboutissent à `bootstrap_dev_impossible`.
5. Le watchdog SLO déclenche les alertes >30 et >45 min (symptôme de stagnation, pas cause primaire).

Impact direct:
- Temps additionnel important sur S023 (déjà >1h45 au moment de ce snapshot).
- Retard en chaîne sur le flux DEV→UXQA→TEA→Reviewer.

---

## 4) Incidents structurants (aujourd’hui + hier)

### A. Boucle reviewer sur S012 (incident majeur)
Symptômes:
- `reviewer_loop_exceeded`: **93** occurrences
- `⚠️ BLOCKED S012 reviewer_loop_exceeded`: **92** occurrences

Cause racine confirmée (mémoire du 2026-02-23):
- La branche runtime `FIX_REVIEWER` ne forçait pas correctement la bascule de recovery vers DEV.
- Résultat: boucle répétée côté reviewer sans convergence technique.

Correctif durable déjà appliqué:
- Patch payload runtime: forcer `set-return reviewer` + `set-step dev` + reset attempt reviewer + blocage explicite recovery.

### B. Timeouts d’orchestration (job/gateway)
Symptômes:
- `job_timeout`: 29
- `gateway_timeout`: 26

Cause racine probable (corrélée aux traces):
- Communication gateway instable/intermittente sur certains ticks.
- Steps longs + retries qui consomment la fenêtre de tick.
- Cascade: timeout gateway → fallback/retard → timeout tick suivant.

### C. Verrous de session (`session_lock`)
Symptômes:
- 15 événements lock explicites (dont le plus récent à 17:56 sur S023).

Cause racine probable:
- Concurrence sur la même session agent (`bmad-dev`) entre runs successifs proches (ou run précédent non totalement relâché).
- Le lock n’est pas levé dans la fenêtre 10s, provoquant l’échec du step.

### D. `bootstrap_dev_impossible` en chaîne
Symptômes:
- 12 occurrences, touchant notamment: S012, S019, S020, S021, S022, S023.

Cause racine:
- Effet combiné `session_lock` + timeouts gateway + retries bornés.
- Le step DEV n’obtient pas de fenêtre d’exécution stable avant seuil de blocage.

### E. Erreurs d’outillage (`rg` manquant)
Symptômes:
- 10 occurrences `rg: command not found`.

Cause:
- Dépendance shell absente côté environnement runner sur certains chemins d’exécution.

Impact:
- Diagnostics incomplets/retardés, retries inutiles.

### F. Limites fournisseur modèle
Symptômes:
- 13 occurrences `You have hit your ChatGPT usage limit...`

Cause:
- Quota/rate limit côté fournisseur à certains moments critiques.

Impact:
- Échecs ponctuels de step agent, augmentation du temps de reprise.

---

## 5) Temps supplémentaire (mesure exploitable)
Mesure conservatrice (minimum prouvé):
- Stories ayant dépassé >45 min: **7** (`S012,S018,S019,S020,S021,S022,S023`)
- Surcoût minimal incompressible: **7 × 45 min = 315 min** (5h15)

Mesure spécifique S023:
- Elapsed checkpoint observé: **~112 min**
- Tentatives DEV observées: **9**

Lecture: le coût réel est supérieur au minimum, car les événements de blocage/timeouts intercalés ajoutent du délai hors simple seuil SLO.

---

## 6) Correctifs déjà appliqués (anti-récurrence)
Déjà en place:
- Patch anti-boucle reviewer (fix structurel recovery reviewer→DEV).
- Runtime checkpoint mode (1 step/tick + retries bornés + watchdog SLO).
- Durcissement du payload role-call (single exec / anti-loop local).
- Guards backlog canonique (`sync` + `verify`) avant exécution.
- Politique communication utile (>30min: cause + action + prochaine étape).

---

## 7) Actions restantes recommandées (priorité)
1. **Lock hygiene DEV**
   - Ajouter un pre-check lock avec age/owner + stratégie de récupération contrôlée.
   - Éviter la réutilisation concurrente de la même session DEV quand un lock récent est détecté.

2. **Gateway stability path**
   - Isoler la cause des `gateway timeout after 270000ms` (connectivité tailnet / saturation / WS).
   - Prévoir fallback déterministe documenté quand timeout répétitif.

3. **Préflight dépendances shell**
   - Vérifier `rg` avant tick (et fallback `grep` explicite si absent).

4. **Gestion quota modèle**
   - Détection anticipée du message `usage limit` pour éviter retries coûteux aveugles.
   - Déclencher immédiatement un chemin de recovery adapté.

---

## 8) Fichiers livrés dans `logs/`
- `errors-2026-02-22_2026-02-23.csv` → **liste complète** des erreurs/blocages
- `errors-2026-02-22_2026-02-23.json` → même contenu (JSON)
- `errors-2026-02-22_2026-02-23.summary.json` → statistiques agrégées
- `postmortem-2026-02-22_2026-02-23.md` → analyse RCA détaillée (ce document)
