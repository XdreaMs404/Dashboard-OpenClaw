# S001 - Normalisation de nom utilisateur (MVP)

## Epic
E01

## User story
En tant qu’utilisateur qui saisit son nom dans un formulaire,
je veux que l’application normalise automatiquement ce nom,
afin d’obtenir un affichage propre, cohérent et exploitable sans perdre les accents ni la casse.

## Critères d'acceptation
- [ ] La fonction `normalizeUserName(input)` est implémentée dans `app/src/core.js` et exportée via `app/src/index.js`.
- [ ] `normalizeUserName("  Jean   Dupont  ")` retourne exactement `"Jean Dupont"`.
- [ ] `normalizeUserName(" Élodie   Martin ")` retourne exactement `"Élodie Martin"` (accents et majuscules préservés).
- [ ] Les séparateurs internes consécutifs (espaces, tabulations, retours ligne) sont réduits à un seul espace.
- [ ] Si la valeur est vide après normalisation (`""`, `"   "`, `"\n\t"`), la fonction lève une `Error` avec le message exact `Le nom utilisateur est vide après normalisation`.
- [ ] Si `input` n’est pas de type chaîne, la fonction lève une `Error` avec le message exact `Le nom utilisateur doit être une chaîne de caractères`.
- [ ] Un flux UI minimal de démonstration est couvert en E2E avec les états `loading`, `empty`, `error`, `success`.
- [ ] En état `success`, la valeur normalisée est affichée dans une zone annoncée (`aria-live="polite"`).
- [ ] En état `error`, un message lisible est affiché sans bloquer une nouvelle saisie.

## Cas de test obligatoires
### Fonctionnels
- [ ] Cas nominal: saisie `"  Jean   Dupont  "` → résultat `"Jean Dupont"`.
- [ ] Cas accents/casse: saisie `"  ÉLODIE   Martin "` → résultat `"ÉLODIE Martin"`.
- [ ] Cas séparateurs multiples: saisie avec espaces + tabulations + retours ligne → un seul espace entre mots.
- [ ] Cas erreur vide: `""`, `"   "`, `"\n\t"` lèvent l’erreur attendue.
- [ ] Cas UI succès: parcours `empty → loading → success` validé en E2E.
- [ ] Cas UI erreur: parcours `empty → loading → error` validé en E2E.

### Non-régression
- [ ] Les comportements existants de `safeDivide`, `normalizeEmail` et `clamp` restent inchangés.
- [ ] Les tests unitaires et edge existants passent sans ajustement de leurs attentes.
- [ ] Le smoke test E2E existant reste vert.

### Sécurité / robustesse
- [ ] Validation stricte du type d’entrée (`string` uniquement).
- [ ] Le traitement d’une chaîne longue (>= 10 000 caractères) reste stable et retourne une sortie correcte.
- [ ] Aucun ajout de dépendance externe pour cette story.
- [ ] Aucun usage de `eval`, `Function` dynamique ou logique risquée inutile.

## Implémentation
### Handoff DEV — ce qu’il faut coder
1. Ajouter `normalizeUserName(input)` dans `app/src/core.js` avec:
   - validation du type,
   - `trim` début/fin,
   - réduction des séparateurs internes (`\s+`) à un espace,
   - levée d’erreur si résultat vide.
2. Exporter la fonction dans `app/src/index.js`.
3. Étendre `app/tests/unit/core.test.js` pour les cas fonctionnels nominaux.
4. Étendre `app/tests/edge/core.edge.test.js` pour les cas robustesse/erreurs.
5. Ajouter un test E2E dédié (fichier probable: `app/tests/e2e/normalize-user-name.spec.js`) qui vérifie les états `loading`, `empty`, `error`, `success` sur une page de démonstration simple.

### Fichiers probables
- `app/src/core.js`
- `app/src/index.js`
- `app/tests/unit/core.test.js`
- `app/tests/edge/core.edge.test.js`
- `app/tests/e2e/normalize-user-name.spec.js`

### Contraintes
- Implémentation en JavaScript ESM, sans dépendance additionnelle.
- Messages d’erreur exacts (contrat testé).
- Préserver strictement les API existantes et leur comportement.
- Respecter l’accessibilité minimale (labels explicites, focus visible, `aria-live`).

## Review
- Vérifier la traçabilité complète: chaque critère d’acceptation doit avoir au moins un test automatisé.
- Vérifier l’absence de régression sur les utilitaires existants.
- Vérifier la conformité UX des 4 états d’interface demandés.
- Vérifier que les messages d’erreur suivent exactement le contrat.

## Comment tester (simple)
1. `cd /root/.openclaw/workspace/bmad-total/app && npm test` pour valider unitaires + intégration.
2. `npm run test:edge` pour valider les cas limites et robustesse.
3. `npm run test:e2e` pour valider le flux UI `loading/empty/error/success`.


## Quality Gates obligatoires
- [ ] lint
- [ ] typecheck
- [ ] tests unit/intégration
- [ ] tests e2e
- [ ] tests cas limites (edge)
- [ ] coverage >= seuil
- [ ] security scan dépendances
- [ ] build

## Règle Story DONE
- Interdit de passer DONE si un seul gate échoue (technique OU UX).
- Audit UX obligatoire: `_bmad-output/implementation-artifacts/ux-audits/<SID>-ux-audit.json` avec verdict PASS.
- Utiliser `bash scripts/story-done-guard.sh <SID>` pour valider la fin.

## UX Gates obligatoires
- [ ] conformité design-system (tokens, spacing, typo, composants)
- [ ] accessibilité WCAG 2.2 AA (minimum)
- [ ] responsive (mobile/tablet/desktop)
- [ ] états d'interface (loading/empty/error/success)
- [ ] hiérarchie visuelle et lisibilité
- [ ] evidence UX fournie (captures/rapports)

## Status
READY_FOR_DEV
